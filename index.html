<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Matti Vuorre" />

<meta name="date" content="2016-07-27" />

<title>bmlm: Multilevel Mediation Modeling with Stan</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #dddddd; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; } /* Keyword */
code > span.dt { color: #800000; } /* DataType */
code > span.dv { color: #0000ff; } /* DecVal */
code > span.bn { color: #0000ff; } /* BaseN */
code > span.fl { color: #800080; } /* Float */
code > span.ch { color: #ff00ff; } /* Char */
code > span.st { color: #dd0000; } /* String */
code > span.co { color: #808080; font-style: italic; } /* Comment */
code > span.al { color: #00ff00; font-weight: bold; } /* Alert */
code > span.fu { color: #000080; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #ff0000; font-weight: bold; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #ff00ff; } /* SpecialChar */
code > span.vs { color: #dd0000; } /* VerbatimString */
code > span.ss { color: #dd0000; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #808080; font-style: italic; } /* Documentation */
code > span.an { color: #808080; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #808080; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #808080; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">bmlm</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Tutorial</a>
</li>
<li>
  <a href="model.html">Model details</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mvuorre/bmlm">
    <span class="fa fa-github fa-lg"></span>
     
    Source
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">bmlm: Multilevel Mediation Modeling with Stan</h1>
<h4 class="author"><em>Matti Vuorre</em></h4>
<h4 class="date"><em>2016-07-27</em></h4>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p><a href="https://github.com/mvuorre/bmlm"><strong>bmlm</strong></a> is an R package that allows easy estimation of multilevel mediation models. <strong>bmlm</strong> uses the <a href="http://mc-stan.org/interfaces/rstan.html">RStan</a> interface to the powerful <a href="http://mc-stan.org/">Stan</a> Bayesian inference engine. Users can estimate, summarize and plot a multilevel mediation model easily with the convenient functions provided with <strong>bmlm</strong>. This document explains how to install <strong>bmlm</strong> and its required components, and then walks through an example of how to use it in practice.</p>
</div>
<div id="installing-bmlm" class="section level1">
<h1>Installing <strong>bmlm</strong></h1>
<p>Please ensure you have the <a href="https://cran.r-project.org/">latest version of R</a> installed.</p>
<p>The latest version of <strong>bmlm</strong> is available on <a href="https://github.com/mvuorre/bmlm">GitHub</a>. To install R packages from GitHub, please install the <code>devtools</code> package first, as shown by the first line below. Then install <strong>bmlm</strong> using devtools:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
<span class="co"># Install from GitHub using the devtools package</span>
devtools::<span class="kw">install_github</span>(<span class="st">&quot;mvuorre/bmlm&quot;</span>, <span class="dt">args =</span> <span class="st">&quot;--preclean&quot;</span>)</code></pre></div>
<p>If something goes wrong during the installation process, you will receive a notice usually asking you to install additional packages. If you are unable to resolve the problems, please contact me or open an issue on <a href="https://github.com/mvuorre/bmlm/issues">GitHub</a>.</p>
<div id="note-for-windows-users" class="section level3">
<h3>Note for Windows users</h3>
<p>Some Windows users may get an error message during the installation process, asking to install <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools33</a>. If this happens, install Rtools33, and retry installing <strong>bmlm</strong>. See <a href="https://github.com/stan-dev/rstan/wiki/Install-Rtools-for-Windows">here</a> if problems persist.</p>
</div>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>After installing the required software, load the <strong>bmlm</strong> package to your current R workspace:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(bmlm)</code></pre></div>
<p><strong>bmlm</strong> contains an example data set from <a href="http://www.intensivelongitudinal.com/index.html">Intensive Longitudinal Methods: An Introduction to Diary and Experience Sampling Research</a> <span class="citation">(Bolger &amp; Laurenceau, 2013)</span>. We’ll use this data set in the example, and first load it into the workspace from the package, and display what the data looks like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(BLch9)
<span class="kw">head</span>(BLch9)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">time</th>
<th align="right">fwkstrs</th>
<th align="right">fwkdis</th>
<th align="right">freldis</th>
<th align="right">x</th>
<th align="right">m</th>
<th align="right">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">101</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">5.59</td>
<td align="right">3.03</td>
<td align="right">0.33</td>
<td align="right">0.98</td>
<td align="right">-1.44</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">5.54</td>
<td align="right">4.62</td>
<td align="right">0.33</td>
<td align="right">0.93</td>
<td align="right">0.14</td>
</tr>
<tr class="odd">
<td align="right">101</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3.89</td>
<td align="right">2.85</td>
<td align="right">0.33</td>
<td align="right">-0.72</td>
<td align="right">-1.63</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">5.35</td>
<td align="right">6.40</td>
<td align="right">1.33</td>
<td align="right">0.75</td>
<td align="right">1.92</td>
</tr>
<tr class="odd">
<td align="right">101</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">4.48</td>
<td align="right">2.54</td>
<td align="right">-1.67</td>
<td align="right">-0.12</td>
<td align="right">-1.93</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">6</td>
<td align="right">2</td>
<td align="right">3.34</td>
<td align="right">5.16</td>
<td align="right">-0.67</td>
<td align="right">-1.27</td>
<td align="right">0.69</td>
</tr>
</tbody>
</table>
<div id="data-preprocessing" class="section level2">
<h2>Data preprocessing</h2>
<p>The goal of multilevel mediation modeling, in this case, is to assess the <em>within-person</em> relationships between X, M and Y. To this end, it is important to isolate the within- and between-person components of X, M, and Y. The <code>isolate()</code> function in <strong>bmlm</strong> allows the user to create within- and between-person centered values of variables, and additionally to standardize them. The example dataset <code>BLch9</code> already contains subject-mean deviated components, but here we illustrate how to obtain these using the <code>isolate()</code> function. The key inputs to this function are <code>d</code>, a data frame; <code>by</code> a column of values that identifies individuals; and <code>value</code>, which variable(s) should be transformed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BLch9 &lt;-<span class="st"> </span><span class="kw">isolate</span>(BLch9, 
                 <span class="dt">by =</span> <span class="st">&quot;id&quot;</span>, 
                 <span class="dt">value =</span> <span class="kw">c</span>(<span class="st">&quot;fwkstrs&quot;</span>, <span class="st">&quot;fwkdis&quot;</span>, <span class="st">&quot;freldis&quot;</span>))</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">time</th>
<th align="right">fwkstrs</th>
<th align="right">fwkdis</th>
<th align="right">freldis</th>
<th align="right">x</th>
<th align="right">m</th>
<th align="right">y</th>
<th align="right">fwkstrs_cw</th>
<th align="right">fwkdis_cw</th>
<th align="right">freldis_cw</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">101</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">5.59</td>
<td align="right">3.03</td>
<td align="right">0.33</td>
<td align="right">0.98</td>
<td align="right">-1.44</td>
<td align="right">0.33</td>
<td align="right">0.98</td>
<td align="right">-1.44</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">5.54</td>
<td align="right">4.62</td>
<td align="right">0.33</td>
<td align="right">0.93</td>
<td align="right">0.14</td>
<td align="right">0.33</td>
<td align="right">0.93</td>
<td align="right">0.14</td>
</tr>
<tr class="odd">
<td align="right">101</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3.89</td>
<td align="right">2.85</td>
<td align="right">0.33</td>
<td align="right">-0.72</td>
<td align="right">-1.63</td>
<td align="right">0.33</td>
<td align="right">-0.72</td>
<td align="right">-1.63</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">5.35</td>
<td align="right">6.40</td>
<td align="right">1.33</td>
<td align="right">0.75</td>
<td align="right">1.92</td>
<td align="right">1.33</td>
<td align="right">0.75</td>
<td align="right">1.92</td>
</tr>
<tr class="odd">
<td align="right">101</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">4.48</td>
<td align="right">2.54</td>
<td align="right">-1.67</td>
<td align="right">-0.12</td>
<td align="right">-1.93</td>
<td align="right">-1.67</td>
<td align="right">-0.12</td>
<td align="right">-1.93</td>
</tr>
<tr class="even">
<td align="right">101</td>
<td align="right">6</td>
<td align="right">2</td>
<td align="right">3.34</td>
<td align="right">5.16</td>
<td align="right">-0.67</td>
<td align="right">-1.27</td>
<td align="right">0.69</td>
<td align="right">-0.67</td>
<td align="right">-1.27</td>
<td align="right">0.69</td>
</tr>
</tbody>
</table>
<p>The <code>..._cw</code> variables now contain isolated within-person (“subject-mean deviated”) pieces of each variable. We’ll use these for the mediation analysis.</p>
</div>
<div id="fit-model" class="section level2">
<h2>Fit model</h2>
<p>To estimate the multilevel mediation model, run <code>mlm()</code> and save its output to an object. Here we’ll call it <code>fit</code>. You can also ask Stan to run multiple MCMC chains in parallel (if supported by your computer), as shown by the first line below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">mc.cores =</span> parallel::<span class="kw">detectCores</span>()) 

fit &lt;-<span class="st"> </span><span class="kw">mlm</span>(<span class="dt">d =</span> BLch9, 
           <span class="dt">id =</span> <span class="st">&quot;id&quot;</span>,
           <span class="dt">x =</span> <span class="st">&quot;fwkstrs_cw&quot;</span>,
           <span class="dt">m =</span> <span class="st">&quot;fwkdis_cw&quot;</span>,
           <span class="dt">y =</span> <span class="st">&quot;freldis_cw&quot;</span>,
           <span class="dt">iter =</span> <span class="dv">2000</span>)</code></pre></div>
<p>The main arguments to <code>mlm()</code> are <code>d</code> (a <code>data.frame</code>), which here was set to <code>BLch9</code>. The user also needs to specify which columns contain the variables needed for the mediation model, unless they are already named <code>id</code>, <code>x</code>, <code>m</code>, and <code>y</code>:</p>
<ul>
<li><code>id</code> is a column of participant IDs in the provided <code>data.frame</code>.</li>
<li><code>x</code> is the manipulated variable.</li>
<li><code>m</code> is the mediator variable.</li>
<li><code>y</code> is the outcome variable.</li>
</ul>
<p>There are various additional arguments to the above command. Most notably, the <code>iter = 2000</code> specified the number of samples to draw from the posterior distribution, for each MCMC chain. The default is to use 4 chains. Further, Stan’s MCMC algorithms use a portion of the samples as warmup to adjust various underlying parameters. The default of one half was used for this example.</p>
<p>Stan’s MCMC procedures are very efficient, but estimating the model with large datasets will take a while. This example takes about 25 seconds on a desktop Mac (8GB RAM, 4ghz Intel i7).</p>
</div>
<div id="summarize-fitted-model" class="section level2">
<h2>Summarize fitted model</h2>
<p>After the samples have been obtained, <strong>bmlm</strong>’s helper functions can be used to obtain summaries of the results. For more options, all <a href="https://cran.r-project.org/web/packages/rstan/index.html">rstan</a> methods are also available.</p>
<div id="numerical-summary" class="section level3">
<h3>Numerical summary</h3>
<p>A numerical summary can be obtained by <code>mlm_summary(fit)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mlm_summary</span>(fit)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="right">Mean</th>
<th align="right">SD</th>
<th align="right">Median</th>
<th align="right">ci_lwr</th>
<th align="right">ci_upr</th>
<th align="right">pprob</th>
<th align="right">n_eff</th>
<th align="right">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.19</td>
<td align="right">0.04</td>
<td align="right">0.19</td>
<td align="right">0.12</td>
<td align="right">0.26</td>
<td align="right">1.00000</td>
<td align="right">2202</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">b</td>
<td align="right">0.15</td>
<td align="right">0.03</td>
<td align="right">0.15</td>
<td align="right">0.09</td>
<td align="right">0.21</td>
<td align="right">1.00000</td>
<td align="right">2059</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cp</td>
<td align="right">0.10</td>
<td align="right">0.02</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">0.15</td>
<td align="right">1.00000</td>
<td align="right">4000</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ab</td>
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.05</td>
<td align="right">0.03</td>
<td align="right">0.08</td>
<td align="right">1.00000</td>
<td align="right">1343</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">c</td>
<td align="right">0.16</td>
<td align="right">0.03</td>
<td align="right">0.16</td>
<td align="right">0.11</td>
<td align="right">0.21</td>
<td align="right">1.00000</td>
<td align="right">2787</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">pme</td>
<td align="right">0.35</td>
<td align="right">0.08</td>
<td align="right">0.34</td>
<td align="right">0.20</td>
<td align="right">0.53</td>
<td align="right">1.00000</td>
<td align="right">1259</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">covab</td>
<td align="right">0.03</td>
<td align="right">0.01</td>
<td align="right">0.03</td>
<td align="right">0.01</td>
<td align="right">0.05</td>
<td align="right">0.99675</td>
<td align="right">1172</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">corrab</td>
<td align="right">0.45</td>
<td align="right">0.15</td>
<td align="right">0.45</td>
<td align="right">0.13</td>
<td align="right">0.72</td>
<td align="right">0.99675</td>
<td align="right">942</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><code>mlm_summary()</code> returns, for each parameter, the following information:</p>
<ul>
<li>Posterior <em>Mean</em>: This can be used as a point estimate of parameter</li>
<li>Posterior <em>SD</em>: The standard deviation of the marginal posterior distribution of plausible parameter values.</li>
<li>Posterior <em>Median</em>: If the posterior distribution is skewed, the median might be used as a more accurate point estimate.</li>
<li>Lower and upper limits to <em>Credible Intervals</em>. The CIs summarize the central X% mass of the marginal posterior distribution, where X% is defined by a <code>level</code> argument to <code>mlm_summary()</code>. The default “confidence level” is 0.91, but users may supply any value they desire.</li>
<li>Posterior probability (<em>pprob</em>), which summarizes the probability density at the observed side of 0. For example, if the estimate (<em>Mean</em>) is -0.55, the posterior probability is defined as the proportion of probability density <em>below zero</em>.</li>
<li>n_eff and Rhat are diagnostic values used to diagnose the performance of the underlying Stan MCMC procedures. see <code>?mlm</code> or <code>?stan</code> for details.</li>
</ul>
</div>
<div id="graphical-summaries" class="section level3">
<h3>Graphical summaries</h3>
<p>Currently, <strong>bmlm</strong> provides two graphical summaries of the estimated model. The first draws a path diagram of the mediation model, with point estimates of the relevant average-level parameters, and their associated credible intervals (as defined by <code>level</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mlm_path_plot</span>(fit, <span class="dt">level =</span> .<span class="dv">89</span>, 
              <span class="dt">xlab =</span> <span class="st">&quot;Work</span><span class="ch">\n</span><span class="st">stressors&quot;</span>,
              <span class="dt">mlab =</span> <span class="st">&quot;Work</span><span class="ch">\n</span><span class="st">dissatisfaction&quot;</span>,
              <span class="dt">ylab =</span> <span class="st">&quot;Relationship</span><span class="ch">\n</span><span class="st">dissatisfaction&quot;</span>,
              <span class="dt">edge.color =</span> <span class="ot">NULL</span>)  <span class="co"># Colors edges</span></code></pre></div>
<div class="figure">
<img src="index_files/figure-html/unnamed-chunk-11-1.png" alt="Path diagram of the average level mediation model, with numerical summaries of the relevant parameters." width="576" />
<p class="caption">
Path diagram of the average level mediation model, with numerical summaries of the relevant parameters.
</p>
</div>
<p>This figure offers a quick view of the estimated model: All paths (<code>a, b, c'</code>) are positive with fairly narrow credible intervals. The upper left corner gives three more parameters: <code>ab</code> is the average mediated effect, <code>c</code> is the total effect, and <code>%me</code> is the percent mediated effect. The width of each arrow represents the magnitude of each relationship, and the color indicates if the relationship is positive (green) or negative (red). The latter option can be turned off by passing argument <code>edge.color = &quot;black&quot;</code>, or by leaving out the argument.</p>
<p>For a more detailed investigation of the model’s parameters, <strong>bmlm</strong> offers two methods for plotting the samples from each parameter’s posterior distribution. These are obtained by a call to <code>mlm_pars_plot(type = X)</code> where <code>X</code> can be either <code>hist</code> for histograms, or <code>coefplot</code> for a coefficient plot. If plotting a coefficient plot, the user may specify <code>level</code> to set the “confidence level”, which is represented by the length of the lines surrounding each point estimate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mlm_pars_plot</span>(fit, <span class="dt">type =</span> <span class="st">&quot;coefplot&quot;</span>, <span class="dt">level =</span> .<span class="dv">50</span>)
<span class="kw">mlm_pars_plot</span>(fit, <span class="dt">type =</span> <span class="st">&quot;coefplot&quot;</span>, <span class="dt">level =</span> .<span class="dv">99</span>,
              <span class="dt">p_size =</span> <span class="dv">3</span>)  <span class="co"># Changes size of points</span></code></pre></div>
<div class="figure">
<img src="index_files/figure-html/unnamed-chunk-12-1.png" alt="Figure 2. A coefficient plot." width="288" /><img src="index_files/figure-html/unnamed-chunk-12-2.png" alt="Figure 2. A coefficient plot." width="288" />
<p class="caption">
Figure 2. A coefficient plot.
</p>
</div>
<p>The user can also specify the parameters to show on the plot, as illustrated in the next histograms:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mlm_pars_plot</span>(fit, <span class="dt">type =</span> <span class="st">&quot;hist&quot;</span>, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;pme&quot;</span>, <span class="st">&quot;covab&quot;</span>))</code></pre></div>
<div class="figure">
<img src="index_files/figure-html/unnamed-chunk-13-1.png" alt="Histograms for a selection of parameters." width="384" />
<p class="caption">
Histograms for a selection of parameters.
</p>
</div>
<p>The histograms are useful for visually assessing the shape of each marginal posterior distribution.</p>
<p>More complex plots are also possible:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mlm_pars_plot</span>(fit, <span class="dt">type =</span> <span class="st">&quot;hist&quot;</span>, <span class="dt">pars =</span> <span class="kw">c</span>(
    <span class="st">&quot;tau[1]&quot;</span>, <span class="st">&quot;Omega[1,2]&quot;</span>, <span class="st">&quot;Omega[1,3]&quot;</span>,
    <span class="st">&quot;Omega[2,1]&quot;</span>, <span class="st">&quot;tau[2]&quot;</span>, <span class="st">&quot;Omega[2,3]&quot;</span>,
    <span class="st">&quot;Omega[3,1]&quot;</span>, <span class="st">&quot;Omega[3,2]&quot;</span>, <span class="st">&quot;tau[3]&quot;</span>),
    <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">color =</span> <span class="st">&quot;skyblue4&quot;</span>)</code></pre></div>
<div class="figure">
<img src="index_files/figure-html/unnamed-chunk-14-1.png" alt="Varying effects standard deviations (tau) and correlations (Omega)." width="480" />
<p class="caption">
Varying effects standard deviations (tau) and correlations (Omega).
</p>
</div>
<p>The first three positions (1: path <code>c'</code>, 2: path <code>b</code>, 3: path <code>a</code>) of the varying effects SDs (<span class="math inline">\(\tau\)</span>) and correlations (<span class="math inline">\(\Omega\)</span>) are plotted as histograms. Each histogram represents the MCMC samples of plausible parameter values from the corresponding posterior distribution.</p>
</div>
</div>
</div>
<div id="tips-and-tricks" class="section level1">
<h1>Tips and tricks</h1>
<p>Users can investigate person-specific effects by modifying the input to the functions above.</p>
<div id="person-specific-effects" class="section level2">
<h2>Person-specific effects</h2>
<p>It is also possible to investigate person-specific parameters. These exist with the same name as the average-level parameters, but have “u_” appended to them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">head</span>(<span class="kw">mlm_summary</span>(fit, <span class="dt">pars =</span> <span class="st">&quot;u_c&quot;</span>))</code></pre></div>
<pre><code>##   Parameter Mean   SD Median ci_lwr ci_upr   pprob n_eff Rhat
## 1    u_c[1] 0.12 0.08   0.12  -0.03   0.29 0.94200  4000    1
## 2    u_c[2] 0.10 0.09   0.10  -0.08   0.28 0.89450  4000    1
## 3    u_c[3] 0.11 0.08   0.11  -0.05   0.30 0.92750  4000    1
## 4    u_c[4] 0.37 0.13   0.36   0.15   0.65 1.00000  4000    1
## 5    u_c[5] 0.09 0.09   0.09  -0.10   0.28 0.84300  4000    1
## 6    u_c[6] 0.09 0.08   0.09  -0.08   0.24 0.86725  4000    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mlm_pars_plot</span>(fit, <span class="dt">pars =</span> <span class="st">&quot;u_cp&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;coef&quot;</span>, <span class="dt">level =</span> .<span class="dv">8</span>)</code></pre></div>
<div class="figure">
<img src="index_files/figure-html/unnamed-chunk-15-1.png" alt="Participant-specific c' path values with 80% Credible Intervals." width="384" />
<p class="caption">
Participant-specific c’ path values with 80% Credible Intervals.
</p>
</div>
<p>Path diagrams can also be plotted for specific individuals:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">mlm_path_plot</span>(fit, <span class="dt">id =</span> <span class="dv">1</span>)
<span class="kw">mlm_path_plot</span>(fit, <span class="dt">id =</span> <span class="dv">25</span>)
<span class="kw">mlm_path_plot</span>(fit, <span class="dt">id =</span> <span class="dv">50</span>)
<span class="kw">mlm_path_plot</span>(fit, <span class="dt">id =</span> <span class="dv">75</span>)</code></pre></div>
<p><img src="index_files/figure-html/indiv-path-plots-1.png" width="672" /></p>
</div>
<div id="avoid-copy-pasting" class="section level2">
<h2>Avoid copy-pasting</h2>
<p>Copy-pasting results from the R console to manuscripts and reports is error prone. Users may export summary tables automatically to a Word document by using <code>tab2doc()</code>. Note that this function requires the <a href="https://cran.r-project.org/web/packages/ReporteRs/index.html"><strong>ReporteRs</strong> package</a> <span class="citation">(Gohel, 2016)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tab2doc</span>(<span class="kw">mlm_summary</span>(fit))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>This function saves a word document with a table of the model’s results. Users may further edit the table’s aesthetics manually in Word.</p>
<div class="figure">
<img src="common/table.png" alt="Summary table exported to Word using tab2doc()" />
<p class="caption">Summary table exported to Word using tab2doc()</p>
</div>
</div>
</div>
<div id="further-information" class="section level1">
<h1>Further information</h1>
<p>The functions contained in <strong>bmlm</strong> have various options available for the user. Inspect these options by looking at the functions’ help pages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?mlm
?mlm_summary
?mlm_path_plot
?mlm_pars_plot</code></pre></div>
<p>Users can also input any valid <code>stan()</code> arguments to <code>mlm()</code>; see <code>?stan</code> for details. The fitted object from <code>mlm()</code> is a valid <code>Stanfit</code> object, so all <code>Stanfit</code> methods are available as well. For example, it is important to assess the performance of Stan’s MCMC algorithms after estimating a model by, for example, inspecting traceplots for convergence problems:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstan)
pars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;cp&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;corrab&quot;</span>)
<span class="kw">traceplot</span>(fit, <span class="dt">pars =</span> pars)</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" width="576" /></p>
<p>Further modification of the model is possible through modifying the Stan code underlying <code>mlm()</code>. See <a href="model.html">here</a> for further details.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-bolger_intensive_2013">
<p>Bolger, N., &amp; Laurenceau, J.-P. (2013). <em>Intensive longitudinal methods: An introduction to diary and experience sampling research</em>. Guilford Press.</p>
</div>
<div id="ref-gohel_reporters:_2016">
<p>Gohel, D. (2016). ReporteRs: Microsoft word, microsoft PowerPoint and HTML documents generation (Version 0.8.6). Retrieved from <a href="https://cran.r-project.org/web/packages/ReporteRs/index.html" class="uri">https://cran.r-project.org/web/packages/ReporteRs/index.html</a></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
